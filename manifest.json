{
  "$schema": "https://stina.app/schemas/extension-manifest.json",
  "id": "work-manager",
  "name": "Work Manager",
  "version": "0.1.0",
  "description": "Manage work todos and projects.",
  "type": "tools",
  "author": {
    "name": "Stina Team",
    "url": "https://github.com/einord"
  },
  "repository": "https://github.com/einord/stina-ext-work",
  "license": "MIT",
  "engines": {
    "stina": ">=0.7.1"
  },
  "platforms": ["web", "electron", "tui"],
  "main": "index.js",

  "permissions": [
    "tools.register",
    "actions.register",
    "panels.register",
    "events.emit",
    "database.own",
    "scheduler.register",
    "chat.message.write",
    "user.profile.read"
  ],

  "contributes": {
    "toolSettings": [
      {
        "id": "projects",
        "title": "Projects",
        "description": "Manage work projects.",
        "view": {
          "kind": "list",
          "listToolId": "work_projects_list",
          "getToolId": "work_projects_get",
          "upsertToolId": "work_projects_upsert",
          "deleteToolId": "work_projects_delete",
          "mapping": {
            "itemsKey": "projects",
            "countKey": "count",
            "idKey": "id",
            "labelKey": "name",
            "descriptionKey": "description"
          },
          "searchParam": "query",
          "limitParam": "limit",
          "idParam": "id"
        },
        "fields": [
          {
            "id": "name",
            "title": "Name",
            "type": "string",
            "validation": { "required": true }
          },
          {
            "id": "description",
            "title": "Description",
            "type": "string"
          }
        ]
      },
      {
        "id": "reminders",
        "title": "Reminders",
        "description": "Default reminder behavior for todos.",
        "view": {
          "kind": "component",
          "data": {
            "settings": {
              "action": "getSettings",
              "refreshOn": ["work.settings.changed"]
            }
          },
          "content": {
            "component": "VerticalStack",
            "gap": 1,
            "children": [
              {
                "component": "Select",
                "label": "Default reminder",
                "options": [
                  { "label": "No reminder", "value": "null" },
                  { "label": "At time", "value": "0" },
                  { "label": "1 minute before", "value": "1" },
                  { "label": "5 minutes before", "value": "5" },
                  { "label": "10 minutes before", "value": "10" },
                  { "label": "15 minutes before", "value": "15" },
                  { "label": "30 minutes before", "value": "30" },
                  { "label": "1 hour before", "value": "60" }
                ],
                "selectedValue": "$settings.defaultReminderMinutes",
                "onChangeAction": {
                  "action": "updateSetting",
                  "params": { "key": "defaultReminderMinutes", "value": "$value" }
                }
              },
              {
                "component": "TextInput",
                "label": "All-day reminder time (HH:MM)",
                "placeholder": "09:00",
                "value": "$settings.allDayReminderTime",
                "onChangeAction": {
                  "action": "updateSetting",
                  "params": { "key": "allDayReminderTime", "value": "$value" }
                }
              },
              {
                "component": "Select",
                "label": "Reminder language",
                "options": [
                  { "label": "Auto", "value": "auto" },
                  { "label": "Swedish", "value": "sv" },
                  { "label": "English", "value": "en" }
                ],
                "selectedValue": "$settings.reminderLocale",
                "onChangeAction": {
                  "action": "updateSetting",
                  "params": { "key": "reminderLocale", "value": "$value" }
                }
              }
            ]
          }
        }
      }
    ],
    "panels": [
      {
        "id": "work.todos",
        "title": "Work",
        "icon": "check-list",
        "view": {
          "kind": "component",
          "data": {
            "groups": {
              "action": "getGroups",
              "refreshOn": [
                "work.todo.changed",
                "work.project.changed"
              ]
            }
          },
          "content": {
            "component": "VerticalStack",
            "gap": 1,
            "children": {
              "each": "$groups",
              "as": "group",
              "items": [
                {
                  "component": "Panel",
                  "title": "$group.title",
                  "icon": "folder-01",
                  "content": {
                    "component": "VerticalStack",
                    "gap": 0.5,
                    "children": {
                      "each": "$group.items",
                      "as": "todo",
                      "items": [
                        {
                          "component": "VerticalStack",
                          "gap": 0.25,
                          "children": [
                            {
                              "component": "HorizontalStack",
                              "gap": 0.5,
                              "children": [
                                { "component": "Icon", "name": "$todo.icon" },
                                { "component": "Label", "text": "$todo.title" }
                              ]
                            },
                            {
                              "component": "HorizontalStack",
                              "gap": 0.5,
                              "style": { "align-items": "center" },
                              "children": [
                                {
                                  "component": "Label",
                                  "text": "$todo.dateTime",
                                  "style": { "font-size": "0.85em", "opacity": "0.8" }
                                },
                                {
                                  "component": "Pill",
                                  "text": "$todo.statusLabel",
                                  "variant": "$todo.statusVariant"
                                }
                              ]
                            },
                            {
                              "component": "VerticalStack",
                              "gap": 0.25,
                              "style": { "padding-left": "1.5rem", "margin-top": "0.25rem" },
                              "children": {
                                "each": "$todo.comments",
                                "as": "comment",
                                "items": [
                                  {
                                    "component": "Label",
                                    "text": "$comment.text",
                                    "style": { "font-size": "0.8em", "opacity": "0.7" }
                                  }
                                ]
                              }
                            }
                          ]
                        }
                      ]
                    }
                  }
                }
              ]
            }
          }
        }
      }
    ],
    "tools": [
      {
        "id": "work_projects_list",
        "name": "List Projects",
        "description": "List work projects."
      },
      {
        "id": "work_projects_get",
        "name": "Get Project",
        "description": "Get a project by ID."
      },
      {
        "id": "work_projects_upsert",
        "name": "Add/Update Project",
        "description": "Create or update a work project."
      },
      {
        "id": "work_projects_delete",
        "name": "Delete Project",
        "description": "Delete a project by ID."
      },
      {
        "id": "work_todos_list",
        "name": "List Todos",
        "description": "List todos with optional filters."
      },
      {
        "id": "work_todos_get",
        "name": "Get Todo",
        "description": "Get todo details by ID."
      },
      {
        "id": "work_todos_upsert",
        "name": "Add/Update Todo",
        "description": "Create or update a todo item."
      },
      {
        "id": "work_todos_delete",
        "name": "Delete Todo",
        "description": "Delete a todo by ID."
      },
      {
        "id": "work_comments_add",
        "name": "Add Comment",
        "description": "Add a comment to a todo."
      },
      {
        "id": "work_comments_delete",
        "name": "Delete Comment",
        "description": "Delete a comment from a todo."
      },
      {
        "id": "work_subitems_add",
        "name": "Add Subitem",
        "description": "Add a subitem to a todo."
      },
      {
        "id": "work_subitems_delete",
        "name": "Delete Subitem",
        "description": "Delete a subitem from a todo."
      },
      {
        "id": "work_settings_list",
        "name": "List Work Settings",
        "description": "List settings entries for the Work extension."
      },
      {
        "id": "work_settings_get",
        "name": "Get Work Settings",
        "description": "Get work extension settings."
      },
      {
        "id": "work_settings_update",
        "name": "Update Work Settings",
        "description": "Update work extension settings."
      }
    ],
    "prompts": [
      {
        "id": "work-manager-instructions",
        "section": "tools",
        "i18n": {
          "en": "You have access to Work Manager tools for projects, todos, subitems, and comments. Use work_projects_list/get/upsert/delete to manage projects. Use work_todos_list/get/upsert/delete to manage todos; dueAt must be ISO 8601 with timezone. Keep date/time fields consistent with dueAt. Use work_subitems_add/delete and work_subitem_toggle for task steps. Use work_comments_add/delete to keep notes. You can adjust default reminders via work_settings_get/update (defaultReminderMinutes, allDayReminderTime, reminderLocale). When a reminder instruction arrives from the system, respond directly to the user with a friendly reminder tailored to the todo content.",
          "sv": "Du har tillgång till Work Manager-verktyg för projekt, att-göra-poster, delmoment och kommentarer. Använd work_projects_list/get/upsert/delete för projekt. Använd work_todos_list/get/upsert/delete för att-göra-poster; dueAt måste vara ISO 8601 med tidszon. Håll date/time konsekvent med dueAt. Använd work_subitems_add/delete och work_subitem_toggle för delmoment. Använd work_comments_add/delete för anteckningar. Du kan justera standardpåminnelser via work_settings_get/update (defaultReminderMinutes, allDayReminderTime, reminderLocale). När ett påminnelsemeddelande kommer från systemet, svara direkt till användaren med en vänlig påminnelse anpassad till innehållet."
        }
      }
    ]
  }
}
