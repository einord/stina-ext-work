{
  "$schema": "https://stina.app/schemas/extension-manifest.json",
  "id": "work-manager",
  "name": "Work Manager",
  "version": "0.0.26",
  "description": "Manage work todos and projects.",
  "type": "tools",
  "author": {
    "name": "Stina Team",
    "url": "https://github.com/einord"
  },
  "repository": "https://github.com/einord/stina-ext-work",
  "license": "MIT",
  "engines": {
    "stina": ">=0.7.1"
  },
  "platforms": ["web", "electron", "tui"],
  "main": "index.js",

  "permissions": [
    "tools.register",
    "actions.register",
    "panels.register",
    "events.emit",
    "database.own",
    "scheduler.register",
    "chat.message.write",
    "user.profile.read"
  ],

  "contributes": {
    "toolSettings": [
      {
        "id": "projects",
        "title": "Projects",
        "description": "Manage work projects.",
        "view": {
          "kind": "list",
          "listToolId": "work_projects_list",
          "getToolId": "work_projects_get",
          "upsertToolId": "work_projects_upsert",
          "deleteToolId": "work_projects_delete",
          "mapping": {
            "itemsKey": "projects",
            "countKey": "count",
            "idKey": "id",
            "labelKey": "name",
            "descriptionKey": "description"
          },
          "searchParam": "query",
          "limitParam": "limit",
          "idParam": "id"
        },
        "fields": [
          {
            "id": "name",
            "title": "Name",
            "type": "string",
            "validation": { "required": true }
          },
          {
            "id": "description",
            "title": "Description",
            "type": "string"
          }
        ]
      },
      {
        "id": "reminders",
        "title": "Reminders",
        "description": "Default reminder behavior for todos.",
        "view": {
          "kind": "component",
          "data": {
            "settings": {
              "action": "getReminderSettings",
              "refreshOn": ["work.settings.changed"]
            }
          },
          "content": {
            "component": "VerticalStack",
            "gap": 1.5,
            "children": [
              {
                "component": "Select",
                "label": "Default reminder",
                "description": "Used when the user does not specify a reminder offset.",
                "options": [
                  { "value": "null", "label": "No reminder" },
                  { "value": "0", "label": "At time" },
                  { "value": "1", "label": "1 minute before" },
                  { "value": "5", "label": "5 minutes before" },
                  { "value": "10", "label": "10 minutes before" },
                  { "value": "15", "label": "15 minutes before" },
                  { "value": "30", "label": "30 minutes before" },
                  { "value": "60", "label": "1 hour before" }
                ],
                "selectedValue": "$settings.defaultReminderMinutes",
                "onChangeAction": {
                  "action": "updateReminderSetting",
                  "params": { "field": "defaultReminderMinutes" }
                }
              },
              {
                "component": "TextInput",
                "label": "All-day reminder time",
                "description": "HH:MM (24h). Used for all-day todos.",
                "placeholder": "09:00",
                "value": "$settings.allDayReminderTime",
                "onBlurAction": {
                  "action": "updateReminderSetting",
                  "params": { "field": "allDayReminderTime" }
                }
              },
              {
                "component": "Select",
                "label": "Reminder language",
                "description": "Language for reminder instructions to Stina.",
                "options": [
                  { "value": "auto", "label": "Auto" },
                  { "value": "sv", "label": "Swedish" },
                  { "value": "en", "label": "English" }
                ],
                "selectedValue": "$settings.reminderLocale",
                "onChangeAction": {
                  "action": "updateReminderSetting",
                  "params": { "field": "reminderLocale" }
                }
              }
            ]
          }
        }
      }
    ],
    "panels": [
      {
        "id": "work.todos",
        "title": "Work",
        "icon": "check-list",
        "view": {
          "kind": "component",
          "data": {
            "groups": {
              "action": "getGroups",
              "refreshOn": ["work.todo.changed", "work.project.changed"]
            },
            "editingTodo": {
              "action": "getEditingTodo",
              "refreshOn": ["work.editModal.changed"]
            }
          },
          "content": {
            "component": "VerticalStack",
            "gap": 1,
            "children": [
              {
                "component": "VerticalStack",
                "gap": 1,
                "children": {
                  "each": "$groups",
                  "as": "project",
                  "items": [
                    {
                      "component": "Collapsible",
                      "title": "$project.title",
                      "icon": "folder-01",
                      "defaultExpanded": false,
                      "content": {
                        "component": "VerticalStack",
                        "gap": 0.5,
                        "children": {
                          "each": "$project.items",
                          "as": "todo",
                          "items": [
                            {
                              "component": "Collapsible",
                              "title": "$todo.title",
                              "description": "$todo.date",
                              "icon": "$todo.icon",
                              "defaultExpanded": false,
                              "style": { "background": "transparent" },
                              "content": {
                                "component": "VerticalStack",
                                "gap": 0.5,
                                "children": [
                                  {
                                    "component": "Paragraph",
                                    "text": "$todo.description"
                                  },
                                  {
                                    "component": "HorizontalStack",
                                    "style": { "justify-content": "flex-end" },
                                    "children": [
                                      {
                                        "component": "IconButton",
                                        "icon": "pencil-edit-01",
                                        "tooltip": "Redigera",
                                        "onClickAction": {
                                          "action": "editTodo",
                                          "params": { "todoId": "$todo.id" }
                                        }
                                      }
                                    ]
                                  },
                                  {
                                    "component": "VerticalStack",
                                    "gap": 0.25,
                                    "children": {
                                      "each": "$todo.subItems",
                                      "as": "subitem",
                                      "items": [
                                        {
                                          "component": "Checkbox",
                                          "label": "$subitem.text",
                                          "checked": "$subitem.completedAt",
                                          "strikethrough": true,
                                          "onChangeAction": {
                                            "action": "toggleSubitem",
                                            "params": {
                                              "todoId": "$todo.id",
                                              "subitemId": "$subitem.id"
                                            }
                                          }
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "component": "VerticalStack",
                                    "gap": 0.25,
                                    "children": {
                                      "each": "$todo.comments",
                                      "as": "comment",
                                      "items": [
                                        {
                                          "component": "Markdown",
                                          "content": "$comment.text"
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            }
                          ]
                        }
                      }
                    }
                  ]
                }
              },
              {
                "component": "Modal",
                "title": "Redigera todo",
                "open": "$editingTodo",
                "onCloseAction": "closeEditModal",
                "body": {
                  "component": "VerticalStack",
                  "gap": 1,
                  "children": [
                    {
                      "component": "TextInput",
                      "label": "Titel",
                      "value": "$editingTodo.title",
                      "onChangeAction": {
                        "action": "updateEditField",
                        "params": { "field": "title" }
                      }
                    },
                    {
                      "component": "TextInput",
                      "label": "Beskrivning",
                      "value": "$editingTodo.description",
                      "onChangeAction": {
                        "action": "updateEditField",
                        "params": { "field": "description" }
                      }
                    },
                    {
                      "component": "Select",
                      "label": "Status",
                      "selectedValue": "$editingTodo.status",
                      "options": [
                        { "label": "Ej påbörjad", "value": "not_started" },
                        { "label": "Pågående", "value": "in_progress" },
                        { "label": "Klar", "value": "completed" },
                        { "label": "Avbruten", "value": "cancelled" }
                      ],
                      "onChangeAction": {
                        "action": "updateEditField",
                        "params": { "field": "status" }
                      }
                    },
                    {
                      "component": "DateTimeInput",
                      "label": "Tidpunkt",
                      "value": "$editingTodo.dueAt",
                      "onChangeAction": {
                        "action": "updateEditField",
                        "params": { "field": "dueAt" }
                      }
                    }
                  ]
                },
                "footer": {
                  "component": "HorizontalStack",
                  "gap": 0.5,
                  "style": { "justify-content": "flex-end" },
                  "children": [
                    {
                      "component": "Button",
                      "text": "Avbryt",
                      "onClickAction": "closeEditModal"
                    },
                    {
                      "component": "Button",
                      "text": "Spara",
                      "onClickAction": "saveEditTodo"
                    }
                  ]
                }
              }
            ]
          }
        }
      }
    ],
    "tools": [
      {
        "id": "work_projects_list",
        "name": "List Projects",
        "description": "List work projects."
      },
      {
        "id": "work_projects_get",
        "name": "Get Project",
        "description": "Get a project by ID."
      },
      {
        "id": "work_projects_upsert",
        "name": "Add/Update Project",
        "description": "Create or update a work project."
      },
      {
        "id": "work_projects_delete",
        "name": "Delete Project",
        "description": "Delete a project by ID."
      },
      {
        "id": "work_todos_list",
        "name": "List Todos",
        "description": "List todos with optional filters."
      },
      {
        "id": "work_todos_get",
        "name": "Get Todo",
        "description": "Get todo details by ID."
      },
      {
        "id": "work_todos_upsert",
        "name": "Add/Update Todo",
        "description": "Create or update a todo item."
      },
      {
        "id": "work_todos_delete",
        "name": "Delete Todo",
        "description": "Delete a todo by ID."
      },
      {
        "id": "work_comments_add",
        "name": "Add Comment",
        "description": "Add a comment to a todo."
      },
      {
        "id": "work_comments_delete",
        "name": "Delete Comment",
        "description": "Delete a comment from a todo."
      },
      {
        "id": "work_subitems_add",
        "name": "Add Subitem",
        "description": "Add a subitem to a todo."
      },
      {
        "id": "work_subitems_delete",
        "name": "Delete Subitem",
        "description": "Delete a subitem from a todo."
      },
      {
        "id": "work_settings_list",
        "name": "List Work Settings",
        "description": "List settings entries for the Work extension."
      },
      {
        "id": "work_settings_get",
        "name": "Get Work Settings",
        "description": "Get work extension settings."
      },
      {
        "id": "work_settings_update",
        "name": "Update Work Settings",
        "description": "Update work extension settings."
      }
    ],
    "prompts": [
      {
        "id": "work-manager-instructions",
        "section": "tools",
        "i18n": {
          "en": "You have access to Work Manager tools for projects, todos, subitems, and comments. Use work_projects_list/get/upsert/delete to manage projects. Use work_todos_list/get/upsert/delete to manage todos; dueAt must be ISO 8601 with timezone. Keep date/time fields consistent with dueAt. Use work_subitems_add/delete and work_subitem_toggle for task steps. Use work_comments_add/delete to keep notes. You can adjust default reminders via work_settings_get/update (defaultReminderMinutes, allDayReminderTime, reminderLocale). When a reminder instruction arrives from the system, respond directly to the user with a friendly reminder tailored to the todo content.",
          "sv": "Du har tillgång till Work Manager-verktyg för projekt, att-göra-poster, delmoment och kommentarer. Använd work_projects_list/get/upsert/delete för projekt. Använd work_todos_list/get/upsert/delete för att-göra-poster; dueAt måste vara ISO 8601 med tidszon. Håll date/time konsekvent med dueAt. Använd work_subitems_add/delete och work_subitem_toggle för delmoment. Använd work_comments_add/delete för anteckningar. Du kan justera standardpåminnelser via work_settings_get/update (defaultReminderMinutes, allDayReminderTime, reminderLocale). När ett påminnelsemeddelande kommer från systemet, svara direkt till användaren med en vänlig påminnelse anpassad till innehållet."
        }
      }
    ]
  }
}
