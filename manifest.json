{
  "$schema": "https://stina.app/schemas/extension-manifest.json",
  "id": "work-manager",
  "name": "Work Manager",
  "version": "0.0.21",
  "description": "Manage work todos and projects.",
  "type": "tools",
  "author": {
    "name": "Stina Team",
    "url": "https://github.com/einord"
  },
  "repository": "https://github.com/einord/stina-ext-work",
  "license": "MIT",
  "engines": {
    "stina": ">=0.7.1"
  },
  "platforms": ["web", "electron", "tui"],
  "main": "index.js",

  "permissions": [
    "tools.register",
    "panels.register",
    "events.emit",
    "database.own",
    "scheduler.register",
    "chat.message.write",
    "user.profile.read"
  ],

  "contributes": {
    "toolSettings": [
      {
        "id": "projects",
        "title": "Projects",
        "description": "Manage work projects.",
        "view": {
          "kind": "list",
          "listToolId": "work_projects_list",
          "getToolId": "work_projects_get",
          "upsertToolId": "work_projects_upsert",
          "deleteToolId": "work_projects_delete",
          "mapping": {
            "itemsKey": "projects",
            "countKey": "count",
            "idKey": "id",
            "labelKey": "name",
            "descriptionKey": "description"
          },
          "searchParam": "query",
          "limitParam": "limit",
          "idParam": "id"
        },
        "fields": [
          {
            "id": "name",
            "title": "Name",
            "type": "string",
            "validation": { "required": true }
          },
          {
            "id": "description",
            "title": "Description",
            "type": "string"
          }
        ]
      },
      {
        "id": "reminders",
        "title": "Reminders",
        "description": "Default reminder behavior for todos.",
        "view": {
          "kind": "list",
          "listToolId": "work_settings_list",
          "getToolId": "work_settings_get",
          "upsertToolId": "work_settings_update",
          "mapping": {
            "itemsKey": "settings",
            "countKey": "count",
            "idKey": "id",
            "labelKey": "label",
            "descriptionKey": "description"
          },
          "idParam": "id"
        },
        "fields": [
          {
            "id": "defaultReminderMinutes",
            "title": "Default reminder",
            "description": "Used when the user does not specify a reminder offset.",
            "type": "select",
            "default": "null",
            "options": [
              { "value": "null", "label": "No reminder" },
              { "value": "0", "label": "At time" },
              { "value": "5", "label": "5 minutes before" },
              { "value": "10", "label": "10 minutes before" },
              { "value": "15", "label": "15 minutes before" },
              { "value": "30", "label": "30 minutes before" },
              { "value": "60", "label": "1 hour before" }
            ]
          },
          {
            "id": "allDayReminderTime",
            "title": "All-day reminder time",
            "description": "HH:MM (24h). Used for all-day todos.",
            "type": "string"
          },
          {
            "id": "reminderLocale",
            "title": "Reminder language",
            "description": "Language for reminder instructions to Stina.",
            "type": "select",
            "default": "auto",
            "options": [
              { "value": "auto", "label": "Auto" },
              { "value": "sv", "label": "Swedish" },
              { "value": "en", "label": "English" }
            ]
          }
        ]
      }
    ],
    "panels": [
      {
        "id": "work.todos",
        "title": "Work",
        "icon": "check-list",
        "view": {
          "kind": "grouped-list",
          "data": {
            "toolId": "work_panel_list",
            "resultKey": "groups",
            "refreshEvents": [
              "work.todo.changed",
              "work.project.changed",
              "work.panel.state.changed"
            ]
          },
          "group": {
            "idKey": "id",
            "titleKey": "title",
            "itemsKey": "items",
            "collapsedKey": "collapsed",
            "emptyLabel": "No todos"
          },
          "item": {
            "idKey": "id",
            "titleKey": "title",
            "descriptionKey": "description",
            "iconKey": "icon",
            "statusKey": "status",
            "dateKey": "date",
            "timeKey": "time",
            "commentCountKey": "commentCount",
            "comments": {
              "itemsKey": "comments",
              "textKey": "text",
              "idKey": "id",
              "createdAtKey": "createdAt",
              "inputPlaceholder": "Add comment",
              "actions": {
                "add": {
                  "toolId": "work_comments_add",
                  "params": {
                    "todoId": { "ref": "item.id" },
                    "text": { "ref": "state.commentText" }
                  }
                },
                "delete": {
                  "toolId": "work_comments_delete",
                  "params": {
                    "todoId": { "ref": "item.id" },
                    "commentId": { "ref": "comment.id" }
                  }
                }
              }
            },
            "subItems": {
              "itemsKey": "subItems",
              "idKey": "id",
              "textKey": "text",
              "completedAtKey": "completedAt",
              "inputPlaceholder": "Add step",
              "actions": {
                "add": {
                  "toolId": "work_subitems_add",
                  "params": {
                    "todoId": { "ref": "item.id" },
                    "text": { "ref": "state.subItemText" }
                  }
                },
                "delete": {
                  "toolId": "work_subitems_delete",
                  "params": {
                    "todoId": { "ref": "item.id" },
                    "subItemId": { "ref": "subItem.id" }
                  }
                }
              }
            }
          },
          "actions": {
            "toggleGroup": {
              "toolId": "work_panel_toggle_group",
              "params": {
                "groupId": { "ref": "group.id" },
                "collapsed": { "ref": "state.collapsed" }
              }
            },
            "toggleSubItem": {
              "toolId": "work_subitem_toggle",
              "params": {
                "todoId": { "ref": "item.id" },
                "subItemId": { "ref": "subItem.id" }
              }
            },
            "editItem": {
              "toolId": "work_todo_edit",
              "params": {
                "id": { "ref": "item.id" }
              }
            }
          },
          "editor": {
            "title": "Edit todo",
            "createLabel": "New todo",
            "getToolId": "work_todos_get",
            "upsertToolId": "work_todos_upsert",
            "deleteToolId": "work_todos_delete",
            "fields": [
              {
                "id": "title",
                "title": "Title",
                "type": "string",
                "validation": { "required": true }
              },
              {
                "id": "description",
                "title": "Description",
                "type": "string"
              },
              {
                "id": "icon",
                "title": "Icon",
                "type": "string",
                "default": "check-list",
                "validation": { "required": true }
              },
              {
                "id": "status",
                "title": "Status",
                "type": "select",
                "default": "not_started",
                "options": [
                  { "value": "not_started", "label": "Not started" },
                  { "value": "in_progress", "label": "In progress" },
                  { "value": "completed", "label": "Completed" },
                  { "value": "cancelled", "label": "Cancelled" }
                ]
              },
              {
                "id": "projectId",
                "title": "Project",
                "type": "select",
                "default": "",
                "options": [
                  { "value": "", "label": "No project" }
                ],
                "optionsToolId": "work_projects_list",
                "optionsParams": { "limit": 200 },
                "optionsMapping": {
                  "itemsKey": "projects",
                  "valueKey": "id",
                  "labelKey": "name"
                },
                "createToolId": "work_projects_upsert",
                "createLabel": "Create project",
                "createFields": [
                  {
                    "id": "name",
                    "title": "Name",
                    "type": "string",
                    "validation": { "required": true }
                  },
                  {
                    "id": "description",
                    "title": "Description",
                    "type": "string"
                  }
                ],
                "createMapping": {
                  "valueKey": "id"
                }
              },
              {
                "id": "dueAt",
                "title": "Due at (ISO 8601)",
                "type": "string",
                "validation": { "required": true }
              },
              {
                "id": "date",
                "title": "Date (YYYY-MM-DD)",
                "type": "string"
              },
              {
                "id": "time",
                "title": "Time (HH:MM)",
                "type": "string"
              },
              {
                "id": "allDay",
                "title": "All day",
                "type": "boolean",
                "default": false
              },
              {
                "id": "reminderMinutes",
                "title": "Reminder minutes",
                "type": "select",
                "default": "",
                "options": [
                  { "value": "", "label": "Use default" },
                  { "value": "null", "label": "No reminder" },
                  { "value": "0", "label": "At time" },
                  { "value": "5", "label": "5 minutes before" },
                  { "value": "10", "label": "10 minutes before" },
                  { "value": "15", "label": "15 minutes before" },
                  { "value": "30", "label": "30 minutes before" },
                  { "value": "60", "label": "1 hour before" }
                ]
              }
            ]
          }
        }
      }
    ],
    "tools": [
      {
        "id": "work_panel_list",
        "name": "List Work Panel",
        "description": "List todo groups for the work panel."
      },
      {
        "id": "work_panel_toggle_group",
        "name": "Toggle Work Group",
        "description": "Toggle collapsed state for a work group."
      },
      {
        "id": "work_subitem_toggle",
        "name": "Toggle Work Subitem",
        "description": "Toggle completion for a work todo subitem."
      },
      {
        "id": "work_todo_edit",
        "name": "Edit Work Todo",
        "description": "Open or update work todo details."
      },
      {
        "id": "work_projects_list",
        "name": "List Projects",
        "description": "List work projects."
      },
      {
        "id": "work_projects_get",
        "name": "Get Project",
        "description": "Get a project by ID."
      },
      {
        "id": "work_projects_upsert",
        "name": "Add/Update Project",
        "description": "Create or update a work project."
      },
      {
        "id": "work_projects_delete",
        "name": "Delete Project",
        "description": "Delete a project by ID."
      },
      {
        "id": "work_todos_list",
        "name": "List Todos",
        "description": "List todos with optional filters."
      },
      {
        "id": "work_todos_get",
        "name": "Get Todo",
        "description": "Get todo details by ID."
      },
      {
        "id": "work_todos_upsert",
        "name": "Add/Update Todo",
        "description": "Create or update a todo item."
      },
      {
        "id": "work_todos_delete",
        "name": "Delete Todo",
        "description": "Delete a todo by ID."
      },
      {
        "id": "work_comments_add",
        "name": "Add Comment",
        "description": "Add a comment to a todo."
      },
      {
        "id": "work_comments_delete",
        "name": "Delete Comment",
        "description": "Delete a comment from a todo."
      },
      {
        "id": "work_subitems_add",
        "name": "Add Subitem",
        "description": "Add a subitem to a todo."
      },
      {
        "id": "work_subitems_delete",
        "name": "Delete Subitem",
        "description": "Delete a subitem from a todo."
      },
      {
        "id": "work_settings_list",
        "name": "List Work Settings",
        "description": "List settings entries for the Work extension."
      },
      {
        "id": "work_settings_get",
        "name": "Get Work Settings",
        "description": "Get work extension settings."
      },
      {
        "id": "work_settings_update",
        "name": "Update Work Settings",
        "description": "Update work extension settings."
      }
    ],
    "prompts": [
      {
        "id": "work-manager-instructions",
        "section": "tools",
        "i18n": {
          "en": "You have access to Work Manager tools for projects, todos, subitems, and comments. Use work_projects_list/get/upsert/delete to manage projects. Use work_todos_list/get/upsert/delete to manage todos; dueAt must be ISO 8601 with timezone. Keep date/time fields consistent with dueAt. Use work_subitems_add/delete and work_subitem_toggle for task steps. Use work_comments_add/delete to keep notes. You can adjust default reminders via work_settings_get/update (defaultReminderMinutes, allDayReminderTime, reminderLocale). When a reminder instruction arrives from the system, respond directly to the user with a friendly reminder tailored to the todo content.",
          "sv": "Du har tillgång till Work Manager-verktyg för projekt, att-göra-poster, delmoment och kommentarer. Använd work_projects_list/get/upsert/delete för projekt. Använd work_todos_list/get/upsert/delete för att-göra-poster; dueAt måste vara ISO 8601 med tidszon. Håll date/time konsekvent med dueAt. Använd work_subitems_add/delete och work_subitem_toggle för delmoment. Använd work_comments_add/delete för anteckningar. Du kan justera standardpåminnelser via work_settings_get/update (defaultReminderMinutes, allDayReminderTime, reminderLocale). När ett påminnelsemeddelande kommer från systemet, svara direkt till användaren med en vänlig påminnelse anpassad till innehållet."
        }
      }
    ]
  }
}
